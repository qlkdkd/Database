# 10. 회복과 병행 제어

# 1. 트랜잭션
## 트랜잭션(transaction)의 개념
* 트랜잭션: 데이터베이스 관리 시스템은 데이터베이스가 항상 정확하고 일관된 상태를 유지할 수 있도록 다양한 기능을 제공하는데, 그 중심을 트랜잭션이라 함
* 트랜잭션을 관리함으로써 데이터베이스의 회복과 병행 제어 가능
* 결과적으로 데이터베이스가 일관된 상태를 유지할 수 있게 됨

* 트랜잭션은 작업 하느를 수행하는 데 필요한 데이터베이스의 연산들을 모아놓은 것
* 데이터베이스의 논리적인 작업의 단위
* 작업 수행에 필요한 SQL문들의 모임
* 장애 발생 시 복구작업이나 병행제어작업을 위한 중요한 단위로 사용됨
* 데이터베이스의 무결성과 일관성을 보장하기 위해 작업 수행에 필요한 연산들을 하나의 트랜잭션으로 제대로 정의하고 관리해야함

![image](https://github.com/qlkdkd/Database/assets/71871927/1a939547-ae33-4a61-8f74-0833840dc376)
![image](https://github.com/qlkdkd/Database/assets/71871927/15988c32-0e67-4849-8ad4-22d05f1f7592)

> 트랜잭션의 예1: 인터넷 뱅킹
> * 인터넷 뱅킹으로 성호가 은경에게 5000원을 이체할 때 이 작업을 수행하는 데 필요한 SQL문들로 구성된 계좌이체 트랜잭션의 예
> * 계좌 이체 트랜잭션은 2개의 update문으로 구성
> * 성호이 계좌에서 5000원을 인출하려면 계좌번호가 100번인 성호의 잔액에서 5000원을 감소시키는 update문이 필요
> * 은경의 계좌에서 5000원을 입금하려면 계좌번호가 200번인 은경의 잔액을 5000원을 증가시키는 update문이 필요
> * 두 update문을 처리하는 순서는 중요하지 않지만 둘 다 정상적으로 실행되어야 함
> * 만약 첫 번째 update문이 실행된 후 시스템에 장애가 발생하여 두 번째 update문이 실행되지 않으면, 성호가 5000원을 이체했으나 은경은 이 돈을 받지 못해 5000원이 사라지는 모순된 상황이 발생
>
> * 모순된 상황이 발생하도록 하지 않도록 하는 법: **시스템이 정상적으로 작동하게 되었을 때 두 번째 update문을 실행하여 트랜잭션의 모든 update문이 정상적으로 실행되도록 하거나, 첫 번쨰 update문의 실행을 최소하여 데이터베이스를 트랜잭션 작업 전 상태로 되돌아가게 해야함**
> 
> 트랜잭션의 예2: 인터넷 쇼핑몰에서 apple이라는 아이디의 고객이 p01제품을 10개 주문할 때 이 작업을 처리하는 데 필요한 SQL문들로 구성된 상품주문 트랜잭션
> 
